define(function(require,exports,module){require("plugin/jquery"),require("plugin/select2.min"),function($){"use strict";function t(t){var e=t.$header;return t.options.height&&(e=t.$tableHeader),e}function e(e){var i=t(e).find("[data-filter-field]");$.isEmptyObject(e.filterColumnsPartial)||i.each(function(t,i){var l=$(i),a=l.attr("data-filter-field"),r=e.filterColumnsPartial[a];l.is("select")?l.val(r).trigger("change"):l.val(r)})}function i(t,e){var i,l,a=!1,r=0;if($.each(t.columns,function(t,r){if(i="hidden",l=[],r.visible){if(r.filter){var n=r.filter.class?" "+r.filter.class:"";switch(l.push('<div style="margin: 0px 2px 2px 2px;" class="filter'+n+'">'),r.searchable&&(a=!0,i="visible"),r.filter.type.toLowerCase()){case"input":l.push('<input type="text" data-filter-field="'+r.field+'" style="width: 100%; visibility:'+i+'">');break;case"select":l.push('<select data-filter-field="'+r.field+'" style="width: 100%; visibility:'+i+'"></select>')}}else l.push('<div class="no-filter"></div>');$.each(e.children().children(),function(t,e){if((e=$(e)).data("field")===r.field)return e.find(".fht-cell").append(l.join("")),!1})}}),a){var n=e.find("input"),o=e.find("select");n.length>0&&(n.off("keyup").on("keyup",function(e){clearTimeout(r),r=setTimeout(function(){t.onColumnSearch(e)},t.options.searchTimeOut)}),n.off("mouseup").on("mouseup",function(e){var i=$(this);""!==i.val()&&setTimeout(function(){""===i.val()&&(clearTimeout(r),r=setTimeout(function(){t.onColumnSearch(e)},t.options.searchTimeOut))},1)})),o.length>0&&o.on("select2:select",function(e){t.onColumnSearch(e)})}else e.find(".filter").hide()}$.extend($.fn.bootstrapTable.defaults,{filter:!1,filterValues:{}}),$.extend($.fn.bootstrapTable.COLUMN_DEFAULTS,{filter:void 0});var l=$.fn.bootstrapTable.Constructor,a=l.prototype.init,r=l.prototype.initHeader,n=l.prototype.initSearch;l.prototype.init=function(){if(this.options.filter){var l=this;$.isEmptyObject(l.options.filterValues)||(l.filterColumnsPartial=l.options.filterValues,l.options.filterValues={}),this.$el.on("reset-view.bs.table",function(){l.options.height&&(l.$tableHeader.find("select").length>0||l.$tableHeader.find("input").length>0||i(l,l.$tableHeader))}).on("post-header.bs.table",function(){var i,a,r=0;a=t(i=l),$.each(i.columns,function(t,e){if(e.filter&&"select"===e.filter.type){var l=a.find("select[data-filter-field="+e.field+"]");if(l.length>0&&!l.data().select2){e.filter.data.unshift("");var r={placeholder:"",allowClear:!0,data:e.filter.data,dropdownParent:i.$el.closest(".bootstrap-table")};l.select2(r),l.on("select2:unselecting",function(t){t.preventDefault(),l.val(null).trigger("change"),i.searchText=void 0,i.onColumnSearch(t)})}}}),clearTimeout(r),r=setTimeout(function(){e(l)},l.options.searchTimeOut-1e3)}).on("column-switch.bs.table",function(t,i){e(l)})}a.apply(this,Array.prototype.slice.apply(arguments))},l.prototype.initHeader=function(){r.apply(this,Array.prototype.slice.apply(arguments)),this.options.filter&&i(this,this.$header)},l.prototype.initSearch=function(){n.apply(this,Array.prototype.slice.apply(arguments));var t=this,e=t.filterColumnsPartial;"client"===t.options.sidePagination&&(this.data=$.grep(this.data,function(i,l){for(var a in e){var r=t.columns[$.fn.bootstrapTable.utils.getFieldIndex(t.columns,a)],n=e[a].toLowerCase(),o=i[a];if(o=$.fn.bootstrapTable.utils.calculateObjectValue(t.header,t.header.formatters[$.inArray(a,t.header.fields)],[o,i,l],o),r.filterStrictSearch){if(-1===$.inArray(a,t.header.fields)||"string"!=typeof o&&"number"!=typeof o||o.toString().toLowerCase()!==n.toString().toLowerCase())return!1}else if(-1===$.inArray(a,t.header.fields)||"string"!=typeof o&&"number"!=typeof o||-1===(o+"").toLowerCase().indexOf(n))return!1}return!0}))},l.prototype.onColumnSearch=function(t){var e=$(t.currentTarget).attr("data-filter-field"),i=$.trim($(t.currentTarget).val());$.isEmptyObject(this.filterColumnsPartial)&&(this.filterColumnsPartial={}),i?this.filterColumnsPartial[e]=i:delete this.filterColumnsPartial[e],this.options.pageNumber=1,this.onSearch(t)},l.prototype.setFilterData=function(e,i){var l=t(this).find('select[data-filter-field="'+e+'"]');i.unshift(""),l.empty(),l.select2({data:i,placeholder:"",allowClear:!0,dropdownParent:this.$el.closest(".bootstrap-table")}),$.each(this.columns,function(t,l){if(l.field===e)return l.filter.data=i,!1})},l.prototype.setFilterValues=function(t){this.filterColumnsPartial=t},$.fn.bootstrapTable.methods.push("setFilterData"),$.fn.bootstrapTable.methods.push("setFilterValues")}(jQuery)});