define(function(require,exports,module){var $=require("plugin/jquery");$.fn.follow=function(A,t){var H={offsets:{x:0,y:0},position:"4-1",edgeAdjust:!0},I=$.extend({},H,t||{});return $(this).each(function(){var t=$(this);if(0!=A.length){var e,o,i,r,a,n,f,s=t.data("height"),c=t.data("width"),h=$(window).scrollTop(),u=$(window).scrollLeft(),l=parseInt(I.offsets.x,10)||0,d=parseInt(I.offsets.y,10)||0;this.cacheData;s||(s=t.outerHeight()),c||(c=t.outerWidth()),e=A.offset(),o=A.outerHeight(),i=A.outerWidth(),r=e.left,a=e.top;var p,g=I.position,w=!1;$.each(["4-1","1-4","5-7","2-3","2-1","6-8","3-4","4-3","8-6","1-2","7-5","3-2"],function(t,e){e!==g||(w=!0)}),w||(g=H.position);var b=function(t){var e="bottom";switch(t){case"1-4":case"5-7":case"2-3":e="top";break;case"2-1":case"6-8":case"3-4":e="right";break;case"1-2":case"8-6":case"4-3":e="left";break;case"4-1":case"7-5":case"3-2":e="bottom"}return e},m=function(t){return"5-7"===t||"6-8"===t||"8-6"===t||"7-5"===t},v=function(t){if("right"===t){if(r+i+c+l>$(window).width())return!1}else if("bottom"===t){if(a+o+s+d>h+$(window).height())return!1}else if("top"===t){if(a-h<s+d)return!1}else if("left"===t&&r<c+l)return!1;return!0};p=b(g),I.edgeAdjust&&(v(p)?function(){if(!m(g)){var t,e={top:{right:"2-3",left:"1-4"},right:{top:"2-1",bottom:"3-4"},bottom:{right:"3-2",left:"4-1"},left:{top:"1-2",bottom:"4-3"}}[p];if(e)for(t in e)v(t)||(g=e[t])}}():function(){if(m(g)){g={"5-7":"7-5","7-5":"5-7","6-8":"8-6","8-6":"6-8"}[g]}else{var t={top:{left:"3-2",right:"4-1"},right:{bottom:"1-2",top:"4-3"},bottom:{left:"2-3",right:"1-4"},left:{bottom:"2-1",top:"3-4"}}[p],e=[];for(name in t)e.push(name);g=v(e[0])||!v(e[1])?t[e[0]]:t[e[1]]}}());var k=b(g),j=g.split("-")[0];switch(k){case"top":f=a-s,n="1"==j?r:"5"===j?r-(c-i)/2:r-(c-i);break;case"right":n=r+i,f="2"==j?a:"6"===j?a-(s-o)/2:a-(s-o);break;case"bottom":f=a+o,n="4"==j?r:"7"===j?r-(c-i)/2:r-(c-i);break;case"left":n=r-c,f="2"==j?a:"6"===j?a-(c-i)/2:a-(s-o)}if(I.edgeAdjust&&m(g)){var y=$(window).width(),x=$(window).height();"7-5"==g||"5-7"==g?n-u<.5*y?n-u<0&&(n=u):y<n-u+c&&(n=y+u-c):f-h<.5*x?f-h<0&&(f=h):x<f-h+s&&(f=x+h-s)}"top"==k||"left"==k?(n-=l,f-=d):(n+=l,f+=d),t.css({position:"absolute",left:Math.round(n),top:Math.round(f)}).attr("data-align",g)}})};var t=function(t,e,o){e.follow(t,o)};return t.prototype.hide=function(){target.remove()},t});